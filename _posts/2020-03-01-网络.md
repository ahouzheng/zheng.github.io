---
title: 网络
auther: ahou
layout:post
---

## 网络5层和7层模型
应用层（http），传输层（TCP，UDP），网络层（IP），链路层（以太网），物理层
应用层（http），表示层（数据编码与加密），会话层，传输层（TCP，UDP），网络层（IP），链路层（以太网），物理层

## TCP和UDP的区别
- UDP只提供基本的数据传输服务和有限的校验，TCP提供可靠数据传输
- TCP是有连接的，UDP无连接。
- UDP不保证数据的有序性和可靠传输，TCP可以保证有序性和数据可靠传输，通过序号，重传控制，校验和等手段保证这些性质
- TCP占用资源高于UDP，传输速度慢于UDP，UDP适用于要求高速传输的通信场合，比如网络视频会议，在线游戏等
- TCP是点对点通信，UDP可以实现一对一，一对多通信。

## TCP三次握手和四次挥手
**参考文章：https://blog.csdn.net/qq_38950316/article/details/81087809**

**TCP主要首部信息：**  
- 源端口和目的端口，对应发送和接受方应用程序
- 序号seq和确认号ack，存放数据序号（标记数据段传输顺序）和确认号（一般是将收到的序号+1）
- 标志位 SYN，ACK，FIN等，仅在ACK为1时，确认号才有效
- 校验值

**三次握手：**  
首先客户端向服务端发送连接请求，SYN置1，带有序列号seq=x，然后状态变为SYN_SEND  
服务端收到请求后，创建连接，进行响应，SYN置1，ACK置1，带有序列号seq=y,确认号ack=x+1，然后状态变为SYN_REVD  
客户端收到响应后，ACK置1，发送序列号seq=x+1，确认号ack=y+1，然后状态变为established  
服务端收到信息后，状态变为established，连接完全建立

**为什么是三次握手：**  
三次握手可以保证服务端和客户端都可以确定对方能够正常的收发数据  
首先客户端向服务端发送一次数据，然后服务端进行响应，在这两次握手之后，客户端就可以确定服务端可以正常的收发数据，而服务端只收到了客户端数据，只能确定客户端可正常发送数据，不确定他是否可以正常接收自己的数据，所以需要第三次握手，客户端对服务端进行响应，服务端才能确定客户端的正常收发功能。

**四次挥手：**  
当客户端想要终止连接时  
首先客户端发送终止连接请求，使FIN置1，带有序列号seq=u,然后状态变为FIN_WAIT1  
服务端收到终止连接的请求后进行响应，使ACK置1，带有确认号ack=u+1和序列号seq=v，然后状态变为CLOSE_WAIT，客户端收到信息后状态变为FIN_WAIT2  
之后服务端在确定可以关闭连接时，发送关闭连接信息，使FIN和ACK置1，带有确认号ack=u+1和序列号seq=w，然后状态变为LAST_ACK  
客户端收到信息后，发送响应，使ACK置1, 带有确认号ack=w+1和序列号seq=u+1，然后进行入TIME_WAIT等待2个MSL(最长报文段寿命)后closed连接，服务端收到连接后状态立即变为closed  
一般服务端结束连接的时间要早于客户端  

**为什么客户端发送第二个报文段后还要等待2MSL：**  
为了保证连接的正常关闭，需要考虑最后的ack报文可能不能正常发送，如果服务端收不到响应，会重发FIN报文，此时客户端再次发送ACK，然后等待2MSL。MSL（maximum segment lifetime）是报文段的最长寿命，等待2MSL就是一个发送时间和一个回复时间。

**为什么握手是三次，而挥手要四次：**  
在握手时，服务端收到SYN请求时，会直接返回SYN+ACK响应，但在终止连接时，服务端还有未发送完毕的数据，所以只能先回复ACK数据包，等数据发送完毕后，再发送FIN数据包，所以要多一次通信。


## Http
**参考文章：https://www.cnblogs.com/rencoo/p/11940100.html**
http报文分为请求报文request和响应报文response，报文组成为  
报文首部，报文主体  
请求报文首部包含
- 请求行，请求方法，url，http版本
- 首部字段

#### Http报文首部有哪些属性（首部字段）
- cache-control 缓存控制
- connection 连接类型
- keep-alive 保持连接时间
- set-cookie 设置cookie

- content-Type:text/html，表示报文主题的对象类型
- Content-Encoding 
- Content-Language
- Content-Length

- Transfer-Encoding， 报文传输的编码类型
- Accept-Charset 有限使用的字符集
- Accept-Coding 优先内容编码
- Accept-Language 优先语言，自然语言
- host，请求资源所在服务器
- Referer：发出请求的页面的URL
- user-agent


## cookie和session
cookie用于记录用户访问信息，存储在用户端。每次访问对应的域时需要带上cookie，cookie存储的信息会造成网络传输上的负担。  
session可以减轻这种情况，客户端向服务端发起请求后，服务端会建立一个session（会话），存储客户的访问信息，这样在cookie中只需存储一个JSESSIONID信息，服务器收到该ID便可确认客户的身份，session是存储在服务端的。  
**区别：**
- cookie存储在客户端，session存储在服务器上
- cookie不是很安全，可能被截获分析
- session适合保存复杂的数据类型，而cookie是保存ascii码，保存复杂内容不太方便

客户端禁止cookie时，为了表示客户端，会使用url重写，在url增加后sid=xxx
session可以放在文件，内存或数据库中。  
TOMCAT中session在不活跃时默认生命周期是30分钟。