---
title: 数据库
auther: ahou
layout: post
---

## 索引
**还需进一步了解**  
#### 使用索引的优缺点
使用索引可以大大提高查询速度  
索引会降低表的更新速度，对表进行 insert，update，delete时，要同步更新表的索引  
索引会占用磁盘空间的索引文件    

#### 1. 普通索引
创建普通索引的一般语句是：
``` sql
CREATE INDEX indexName ON tableName(columnName(length));
或
ALTER tableName ADD INDEX indexName ON (columnName(length));
```
这两条语句都是在表tableName中为列columnName创建名为indexName的索引
#### 2. 唯一索引
与普通索引的区别是，唯一索引的值必须唯一，但允许有空值。 如果是组合索引，则组合必须唯一  
创建唯一索引的一般语句是：
``` sql
CREATE UNIQUE INDEX indexName ON tableName(columnName(length));
或
ALTER tableName ADD UNIQUE indexName ON (clolumnName(length));
```

#### 3. 主键索引
表的主键是一个特殊的索引,每个表中只能有一个主键  
通过PRIMARY在创建表时指定主键
``` sql
CREATE TABLE tableName(
ID int not null,
userName varchar(20) not null,
PRIMARY KEY(ID));
```

#### 4. 组合索引
将多个列建立组合索引
``` sql
ALTER TABLE tableName ADD INDEX indexName ON (colName1, colName2, colName3);
```

**需要注意包含null值的列不会被包含在索引中**  
**每建立一个索引，该列的值就会被复制一份来生成索引**  

#### 索引原理

索引是通过平衡树来实现高效的查找的  
包含索引的数据在内存中以平衡树来存储
通过主键来建立的索引叫做聚集索引  
其他的索引建立的是非聚集索引  
如果查找基于的是主键的值，那么直接使用聚集索引即可  
如果基于的不是主键值，那么会先通过非聚集索引来查找到主键值，然后再通过聚集索引来定位数据  
所以聚集索引的平衡树叶子节点是实际的数据行，而非聚集索引的叶子节点是主键。

一般的数据查询，最终都是通过主键的聚集索引来查找，例外是
**覆盖索引**


## 一条SQL语句耗时长的原因
**参考文章:  黄小斜微信公众号 https://mp.weixin.qq.com/s?__biz=MzUyOTk5NDQwOA==&mid=2247487500&idx=2&sn=3a0eb0bc9222236daddfabd772e2f687&chksm=fa59d7cbcd2e5edd9c6a89f88a82beecd108817c6ac3a84d58eeaa076d982ac950c7f546f5fb&scene=27#wechat_redirect**

分两种情况讨论  
1. 大部分时间都正常，偶尔很慢
2. 大部分时间都很慢
##
